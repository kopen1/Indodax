<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Indodax Scalper — Python (Vercel)</title>
<style>
:root{--bg:#071018;--card:#0f1720;--muted:#99a1ad;--accent:#7c5cff;--accent-2:#28d19c}
*{box-sizing:border-box}body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto;background:linear-gradient(180deg,var(--bg),#041018);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.container{width:100%;max-width:720px}.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:14px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
.input, select, button{padding:12px;border-radius:10px;border:none;background:#07101a;color:inherit;outline:none;font-size:15px}
.row{display:flex;gap:12px;align-items:center;margin-bottom:10px}
.select{flex:1;border:1px solid rgba(255,255,255,0.04);background:transparent}
.button{background:linear-gradient(90deg,var(--accent),#3d2aff);color:#fff;font-weight:600;cursor:pointer;border-radius:10px;padding:12px 14px}
.small{font-size:13px;color:var(--muted)}
.spinner{width:28px;height:28px;border-radius:50%;border:4px solid rgba(255,255,255,0.06);border-top-color:var(--accent);animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.result{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
.kv{display:flex;justify-content:space-between;padding:6px 0;color:#dbe7f7}
.error{color:#ff9b9b;background:rgba(255,0,0,0.04);padding:8px;border-radius:8px}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div>
        <div style="font-weight:700">Indodax Scalper • Python</div>
        <div class="small">Frontend + API — siap deploy ke Vercel</div>
      </div>
      <div id="status"></div>
    </div>

    <div class="row">
      <input id="search" class="input" placeholder="Cari pasangan (btc / twelve / doge)"/>
      <button id="load" class="button" style="background:linear-gradient(90deg,var(--accent-2),#2bd3a6)">Muat Pasar</button>
    </div>

    <div class="row">
      <select id="select" class="select"><option value="">-- pilih pasangan --</option></select>
      <button id="start" class="button">Mulai Scalping</button>
    </div>

    <div id="result" class="result" style="display:none">
      <div id="loading" style="display:none;text-align:center;padding:8px"><div class="spinner"></div></div>
      <div id="out" style="display:none">
        <div class="kv"><div>Pair</div><div id="p_pair"></div></div>
        <div class="kv"><div>Harga</div><div id="p_price"></div></div>
        <div class="kv"><div>SMA</div><div id="p_sma"></div></div>
        <div class="kv"><div>BB</div><div id="p_bb"></div></div>
        <div class="kv"><div>AvgVol / Recent</div><div id="p_vol"></div></div>
        <div class="kv"><div>Sinyal</div><div id="p_signal"></div></div>
        <div id="p_reasons" style="color:var(--muted);margin-top:8px"></div>
      </div>
      <div id="err" style="display:none" class="error"></div>
    </div>

  </div>
</div>

<script>
const el = id => document.getElementById(id);
let markets = [];
async function loadMarkets(){
  el('status').innerHTML = '<div class="spinner"></div>';
  try{
    const r = await fetch('/api/markets');
    const j = await r.json();
    if(!j.success) throw new Error(j.error || 'Gagal load markets');
    markets = j.markets;
    populate(markets);
    el('status').innerHTML = '<div style="color:var(--muted)">'+markets.length+' markets</div>';
  }catch(e){
    el('status').innerHTML = '<div style="color:#ff9b9b">Gagal</div>';
    alert('Gagal muat market: '+e.message);
  }
}
function populate(list){
  const sel = el('select'); sel.innerHTML = '<option value=\"\">-- pilih pasangan --</option>';
  list.forEach(m => { const o = document.createElement('option'); o.value = m; o.text = m.toUpperCase(); sel.appendChild(o); });
}
el('load').addEventListener('click', ()=>loadMarkets());
el('search').addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  if(!q) return populate(markets);
  populate(markets.filter(m => m.includes(q)));
});
el('start').addEventListener('click', async ()=>{
  const pair = el('select').value;
  if(!pair) return alert('Pilih pasangan dulu');
  el('result').style.display='block'; el('loading').style.display='block'; el('out').style.display='none'; el('err').style.display='none';
  try{
    const r = await fetch(`/api/analyze?pair=${encodeURIComponent(pair)}`);
    const j = await r.json();
    el('loading').style.display='none';
    if(!j.success){ el('err').style.display='block'; el('err').textContent = j.error || 'error'; return; }
    el('p_pair').textContent = j.pair.toUpperCase();
    el('p_price').textContent = j.last_price;
    el('p_sma').textContent = j.sma;
    el('p_bb').textContent = j.bb_upper+' / '+j.bb_lower;
    el('p_vol').textContent = Math.round(j.avg_volume)+' / '+Math.round(j.recent_volume);
    el('p_signal').textContent = j.signal;
    el('p_reasons').textContent = j.reasons && j.reasons.length ? 'Reason: '+j.reasons.join('; ') : '';
    el('out').style.display='block';
  }catch(e){
    el('loading').style.display='none'; el('err').style.display='block'; el('err').textContent = 'Gagal koneksi: '+e.message;
  }
});

window.addEventListener('load', ()=>loadMarkets());
</script>
</body>
</html>
